import{r as e,u as t,j as i}from"./vendor-query-3cLbHxHt.js";import{u as s,c as l}from"./index-ByULtmE-.js";import{c as n}from"./vendor-react-CSmESBJ6.js";import{N as a,P as r,b8 as o,u as d,d as c,q as u,J as x,K as j,O as m,aJ as h,b9 as y,p,U as v,S as g,i as f,aO as _,bd as S,be as q}from"./vendor-antd-Ba3TCcI4.js";import"./vendor-state-hAMrnFl_.js";const{Title:I,Text:b}=u,k={active:"green",enrolling:"blue",closed:"default",suspended:"orange"};function w(){var u,w,F,C,R;const{siteId:P}=n(),{selectedStudyId:z}=s(),[B,D]=e.useState(null),[K,T]=e.useState(!1),[A,Q]=e.useState(null),{data:L=[],isLoading:N}=t({queryKey:["sites",z,B],queryFn:()=>l.getAll({study_id:z||void 0,region:B||void 0})}),{data:O=[]}=t({queryKey:["highRiskSites",z],queryFn:()=>l.getHighRisk(z||void 0)}),{data:H}=t({queryKey:["sitePerformance",null==A?void 0:A.site_id],queryFn:()=>l.getPerformance(A.site_id),enabled:!!A}),J=[...new Set(L.map(e=>e.region).filter(Boolean))],M=[{title:"Site ID",dataIndex:"site_id",key:"site_id",render:(e,t)=>i.jsx("a",{onClick:()=>(Q(t),void T(!0)),children:e}),sorter:(e,t)=>e.site_id.localeCompare(t.site_id)},{title:"Name",dataIndex:"name",key:"name",ellipsis:!0},{title:"Country",dataIndex:"country",key:"country",render:e=>i.jsx(a,{children:e}),filters:[...new Set(L.map(e=>e.country).filter(Boolean))].map(e=>({text:e,value:e})),onFilter:(e,t)=>t.country===e},{title:"Region",dataIndex:"region",key:"region",filters:J.map(e=>({text:e,value:e})),onFilter:(e,t)=>t.region===e},{title:"Status",dataIndex:"status",key:"status",render:e=>i.jsx(a,{color:k[null==e?void 0:e.toLowerCase()]||"default",children:e})},{title:"Patients",dataIndex:"patient_count",key:"patient_count",sorter:(e,t)=>(e.patient_count||0)-(t.patient_count||0)},{title:"DQI Score",dataIndex:"dqi_score",key:"dqi_score",render:e=>i.jsx(r,{percent:Math.round(e||0),size:"small",status:e>=80?"success":e>=60?"normal":"exception"}),sorter:(e,t)=>(e.dqi_score||0)-(t.dqi_score||0)},{title:"Avg Resolution (days)",dataIndex:"query_resolution_time",key:"query_resolution_time",render:e=>i.jsx("span",{style:{color:e>7?"#ff4d4f":e>3?"#faad14":"#52c41a"},children:(null==e?void 0:e.toFixed(1))||"-"}),sorter:(e,t)=>(e.query_resolution_time||0)-(t.query_resolution_time||0)}],U=L.length>0?L.reduce((e,t)=>e+(t.dqi_score||0),0)/L.length:0,$=L.reduce((e,t)=>e+(t.patient_count||0),0);return i.jsxs("div",{children:[i.jsx(o,{items:[{href:"/",title:i.jsx(d,{})},{title:i.jsxs(i.Fragment,{children:[i.jsx(c,{})," Sites"]})}],style:{marginBottom:16}}),i.jsx(I,{level:2,children:"Sites"}),i.jsx(b,{type:"secondary",style:{display:"block",marginBottom:24},children:"Site performance metrics and data quality overview"}),i.jsxs(x,{gutter:[24,24],style:{marginBottom:24},children:[i.jsx(j,{xs:24,sm:12,md:6,children:i.jsx(m,{children:i.jsx(h,{title:"Total Sites",value:L.length,prefix:i.jsx(c,{})})})}),i.jsx(j,{xs:24,sm:12,md:6,children:i.jsx(m,{children:i.jsx(h,{title:"Total Patients",value:$,prefix:i.jsx(y,{})})})}),i.jsx(j,{xs:24,sm:12,md:6,children:i.jsx(m,{children:i.jsx(h,{title:"Avg DQI Score",value:U.toFixed(1),suffix:"%",valueStyle:{color:U>=80?"#52c41a":"#faad14"},prefix:i.jsx(p,{})})})}),i.jsx(j,{xs:24,sm:12,md:6,children:i.jsx(m,{children:i.jsx(h,{title:"High Risk Sites",value:O.length,valueStyle:{color:O.length>0?"#ff4d4f":"#52c41a"},prefix:i.jsx(v,{})})})})]}),i.jsx(m,{style:{marginBottom:24},children:i.jsx(g,{wrap:!0,children:i.jsx(f,{placeholder:"Region",allowClear:!0,style:{width:200},onChange:D,options:J.map(e=>({value:e,label:e}))})})}),i.jsx(m,{children:i.jsx(_,{columns:M,dataSource:L,rowKey:"site_id",loading:N,pagination:{pageSize:15,showSizeChanger:!0}})}),i.jsx(S,{title:`Site: ${null==A?void 0:A.site_id}`,placement:"right",width:600,open:K,onClose:()=>{T(!1),Q(null)},children:A&&i.jsxs(g,{direction:"vertical",size:"large",style:{width:"100%"},children:[i.jsxs(q,{bordered:!0,column:1,size:"small",children:[i.jsx(q.Item,{label:"Site ID",children:A.site_id}),i.jsx(q.Item,{label:"Name",children:A.name}),i.jsx(q.Item,{label:"Country",children:A.country}),i.jsx(q.Item,{label:"Region",children:A.region}),i.jsx(q.Item,{label:"Status",children:i.jsx(a,{color:k[null==(u=A.status)?void 0:u.toLowerCase()],children:A.status})}),i.jsx(q.Item,{label:"Patients",children:A.patient_count})]}),H&&i.jsx(m,{title:"Performance Metrics",size:"small",children:i.jsxs(x,{gutter:[16,16],children:[i.jsx(j,{span:12,children:i.jsx(h,{title:"DQI Score",value:null==(w=H.dqi_score)?void 0:w.toFixed(1),suffix:"%"})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Cleanliness Rate",value:null==(F=H.cleanliness_rate)?void 0:F.toFixed(1),suffix:"%"})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Open Queries",value:H.query_count})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Resolution Rate",value:null==(C=H.query_resolution_rate)?void 0:C.toFixed(1),suffix:"%"})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Avg Resolution Time",value:null==(R=H.avg_resolution_time)?void 0:R.toFixed(1),suffix:"days"})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Protocol Deviations",value:H.protocol_deviations})})]})})]})})]})}export{w as default};
