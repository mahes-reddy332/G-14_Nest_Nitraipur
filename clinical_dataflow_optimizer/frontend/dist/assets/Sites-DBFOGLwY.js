import{r as e,u as t,j as i}from"./vendor-query-3cLbHxHt.js";import{u as s,c as l}from"./index-CLsPU1EI.js";import{c as n}from"./vendor-react-BULyYbn8.js";import{H as a,P as r,b2 as o,u as d,d as c,q as u,F as x,G as j,E as m,aH as h,b3 as y,p,N as v,S as g,i as f,b5 as _,b8 as S,b9 as q}from"./vendor-antd-CMNZCwNL.js";import"./vendor-state-hAMrnFl_.js";const{Title:I,Text:b}=u,k={active:"green",enrolling:"blue",closed:"default",suspended:"orange"};function F(){var u,F,w,C,R;const{siteId:P}=n(),{selectedStudyId:z}=s(),[B,D]=e.useState(null),[T,A]=e.useState(!1),[H,K]=e.useState(null),{data:Q=[],isLoading:L}=t({queryKey:["sites",z,B],queryFn:()=>l.getAll({study_id:z||void 0,region:B||void 0})}),{data:N=[]}=t({queryKey:["highRiskSites",z],queryFn:()=>l.getHighRisk(z||void 0)}),{data:M}=t({queryKey:["sitePerformance",null==H?void 0:H.site_id],queryFn:()=>l.getPerformance(H.site_id),enabled:!!H}),E=[...new Set(Q.map(e=>e.region).filter(Boolean))],G=[{title:"Site ID",dataIndex:"site_id",key:"site_id",render:(e,t)=>i.jsx("a",{onClick:()=>(K(t),void A(!0)),children:e}),sorter:(e,t)=>e.site_id.localeCompare(t.site_id)},{title:"Name",dataIndex:"name",key:"name",ellipsis:!0},{title:"Country",dataIndex:"country",key:"country",render:e=>i.jsx(a,{children:e}),filters:[...new Set(Q.map(e=>e.country).filter(Boolean))].map(e=>({text:e,value:e})),onFilter:(e,t)=>t.country===e},{title:"Region",dataIndex:"region",key:"region",filters:E.map(e=>({text:e,value:e})),onFilter:(e,t)=>t.region===e},{title:"Status",dataIndex:"status",key:"status",render:e=>i.jsx(a,{color:k[null==e?void 0:e.toLowerCase()]||"default",children:e})},{title:"Patients",dataIndex:"patient_count",key:"patient_count",sorter:(e,t)=>(e.patient_count||0)-(t.patient_count||0)},{title:"DQI Score",dataIndex:"dqi_score",key:"dqi_score",render:e=>i.jsx(r,{percent:Math.round(e||0),size:"small",status:e>=80?"success":e>=60?"normal":"exception"}),sorter:(e,t)=>(e.dqi_score||0)-(t.dqi_score||0)},{title:"Avg Resolution (days)",dataIndex:"query_resolution_time",key:"query_resolution_time",render:e=>i.jsx("span",{style:{color:e>7?"#ff4d4f":e>3?"#faad14":"#52c41a"},children:(null==e?void 0:e.toFixed(1))||"-"}),sorter:(e,t)=>(e.query_resolution_time||0)-(t.query_resolution_time||0)}],O=Q.length>0?Q.reduce((e,t)=>e+(t.dqi_score||0),0)/Q.length:0,$=Q.reduce((e,t)=>e+(t.patient_count||0),0);return i.jsxs("div",{children:[i.jsx(o,{items:[{href:"/",title:i.jsx(d,{})},{title:i.jsxs(i.Fragment,{children:[i.jsx(c,{})," Sites"]})}],style:{marginBottom:16}}),i.jsx(I,{level:2,children:"Sites"}),i.jsx(b,{type:"secondary",style:{display:"block",marginBottom:24},children:"Site performance metrics and data quality overview"}),i.jsxs(x,{gutter:[24,24],style:{marginBottom:24},children:[i.jsx(j,{xs:24,sm:12,md:6,children:i.jsx(m,{children:i.jsx(h,{title:"Total Sites",value:Q.length,prefix:i.jsx(c,{})})})}),i.jsx(j,{xs:24,sm:12,md:6,children:i.jsx(m,{children:i.jsx(h,{title:"Total Patients",value:$,prefix:i.jsx(y,{})})})}),i.jsx(j,{xs:24,sm:12,md:6,children:i.jsx(m,{children:i.jsx(h,{title:"Avg DQI Score",value:O.toFixed(1),suffix:"%",valueStyle:{color:O>=80?"#52c41a":"#faad14"},prefix:i.jsx(p,{})})})}),i.jsx(j,{xs:24,sm:12,md:6,children:i.jsx(m,{children:i.jsx(h,{title:"High Risk Sites",value:N.length,valueStyle:{color:N.length>0?"#ff4d4f":"#52c41a"},prefix:i.jsx(v,{})})})})]}),i.jsx(m,{style:{marginBottom:24},children:i.jsx(g,{wrap:!0,children:i.jsx(f,{placeholder:"Region",allowClear:!0,style:{width:200},onChange:D,options:E.map(e=>({value:e,label:e}))})})}),i.jsx(m,{children:i.jsx(_,{columns:G,dataSource:Q,rowKey:"site_id",loading:L,pagination:{pageSize:15,showSizeChanger:!0}})}),i.jsx(S,{title:`Site: ${null==H?void 0:H.site_id}`,placement:"right",width:600,open:T,onClose:()=>{A(!1),K(null)},children:H&&i.jsxs(g,{direction:"vertical",size:"large",style:{width:"100%"},children:[i.jsxs(q,{bordered:!0,column:1,size:"small",children:[i.jsx(q.Item,{label:"Site ID",children:H.site_id}),i.jsx(q.Item,{label:"Name",children:H.name}),i.jsx(q.Item,{label:"Country",children:H.country}),i.jsx(q.Item,{label:"Region",children:H.region}),i.jsx(q.Item,{label:"Status",children:i.jsx(a,{color:k[null==(u=H.status)?void 0:u.toLowerCase()],children:H.status})}),i.jsx(q.Item,{label:"Patients",children:H.patient_count})]}),M&&i.jsx(m,{title:"Performance Metrics",size:"small",children:i.jsxs(x,{gutter:[16,16],children:[i.jsx(j,{span:12,children:i.jsx(h,{title:"DQI Score",value:null==(F=M.dqi_score)?void 0:F.toFixed(1),suffix:"%"})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Cleanliness Rate",value:null==(w=M.cleanliness_rate)?void 0:w.toFixed(1),suffix:"%"})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Open Queries",value:M.query_count})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Resolution Rate",value:null==(C=M.query_resolution_rate)?void 0:C.toFixed(1),suffix:"%"})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Avg Resolution Time",value:null==(R=M.avg_resolution_time)?void 0:R.toFixed(1),suffix:"days"})}),i.jsx(j,{span:12,children:i.jsx(h,{title:"Protocol Deviations",value:M.protocol_deviations})})]})})]})})]})}export{F as default};
