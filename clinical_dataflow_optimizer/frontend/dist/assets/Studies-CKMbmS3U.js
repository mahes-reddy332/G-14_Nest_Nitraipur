import{r as e,u as t,j as s}from"./vendor-query-3cLbHxHt.js";import{s as a}from"./index-ByULtmE-.js";import{c as i}from"./vendor-react-CSmESBJ6.js";import{b8 as l,u as r,b as n,q as d,S as o,N as c,J as u,K as x,O as y,aJ as j,b9 as h,h as p,ba as m,P as _,aO as v,p as f,m as g,bb as S,k as b}from"./vendor-antd-Ba3TCcI4.js";import"./vendor-state-hAMrnFl_.js";const{Title:k,Text:q}=d,I={active:"green",enrolling:"blue",completed:"default",suspended:"orange"};function F(){var d,F,w,L;const{studyId:C}=i(),[K,B]=e.useState("overview"),{data:P=[],isLoading:z}=t({queryKey:["studies"],queryFn:a.getAll,enabled:!C}),{data:D}=t({queryKey:["study",C],queryFn:()=>a.getById(C),enabled:!!C}),{data:M}=t({queryKey:["studyMetrics",C],queryFn:()=>a.getMetrics(C),enabled:!!C}),{data:Q=[],isLoading:T}=t({queryKey:["sourceFiles",C],queryFn:()=>a.getSourceFiles(C),enabled:!!C}),O=[{title:"Study ID",dataIndex:"study_id",key:"study_id",render:e=>s.jsx("a",{href:`/studies/${e}`,children:e})},{title:"Name",dataIndex:"name",key:"name"},{title:"Phase",dataIndex:"phase",key:"phase",render:e=>s.jsx(c,{color:"blue",children:e})},{title:"Status",dataIndex:"status",key:"status",render:e=>s.jsx(c,{color:I[null==e?void 0:e.toLowerCase()]||"default",children:e})},{title:"Patients",dataIndex:"total_patients",key:"total_patients",sorter:(e,t)=>(e.total_patients||0)-(t.total_patients||0)},{title:"Clean %",key:"clean_rate",render:(e,t)=>{const a=t.total_patients>0?(t.clean_patients||0)/t.total_patients*100:0;return s.jsx(_,{percent:Math.round(a),size:"small",status:a>=80?"success":a>=60?"normal":"exception"})},sorter:(e,t)=>(e.total_patients>0?(e.clean_patients||0)/e.total_patients:0)-(t.total_patients>0?(t.clean_patients||0)/t.total_patients:0)},{title:"DQI Score",dataIndex:"dqi_score",key:"dqi_score",render:e=>s.jsx(_,{percent:Math.round(e||0),size:"small",status:e>=80?"success":e>=60?"normal":"exception"}),sorter:(e,t)=>(e.dqi_score||0)-(t.dqi_score||0)},{title:"Sites",dataIndex:"total_sites",key:"total_sites"}];return C&&D?s.jsxs("div",{children:[s.jsx(l,{items:[{href:"/",title:s.jsx(r,{})},{href:"/studies",title:s.jsxs(s.Fragment,{children:[s.jsx(n,{})," Studies"]})},{title:D.study_id}],style:{marginBottom:16}}),s.jsx(k,{level:2,children:D.name||D.study_id}),s.jsxs(o,{style:{marginBottom:24},children:[s.jsx(c,{color:I[null==(d=D.status)?void 0:d.toLowerCase()],children:D.status}),s.jsx(c,{color:"blue",children:D.phase}),D.therapeutic_area&&s.jsx(c,{children:D.therapeutic_area})]}),s.jsxs(u,{gutter:[24,24],style:{marginBottom:24},children:[s.jsx(x,{xs:24,sm:12,md:6,children:s.jsx(y,{children:s.jsx(j,{title:"Total Patients",value:D.total_patients,prefix:s.jsx(h,{})})})}),s.jsx(x,{xs:24,sm:12,md:6,children:s.jsx(y,{children:s.jsx(j,{title:"Clean Patients",value:D.clean_patients,valueStyle:{color:"#52c41a"}})})}),s.jsx(x,{xs:24,sm:12,md:6,children:s.jsx(y,{children:s.jsx(j,{title:"DQI Score",value:null==(F=D.dqi_score)?void 0:F.toFixed(1),suffix:"%",valueStyle:{color:(D.dqi_score||0)>=80?"#52c41a":"#faad14"}})})}),s.jsx(x,{xs:24,sm:12,md:6,children:s.jsx(y,{children:s.jsx(j,{title:"Total Sites",value:D.total_sites,prefix:s.jsx(p,{})})})})]}),s.jsx(y,{children:s.jsx(m,{activeKey:K,onChange:B,items:[{key:"overview",label:"Overview",children:s.jsx("div",{children:M&&s.jsxs(u,{gutter:[24,24],children:[s.jsx(x,{span:12,children:s.jsxs(y,{size:"small",title:"Data Quality",children:[s.jsx(_,{percent:Math.round(M.dqi_score||0),status:M.dqi_score>=80?"success":"normal"}),s.jsxs(q,{type:"secondary",children:["Cleanliness Rate: ",null==(w=M.cleanliness_rate)?void 0:w.toFixed(1),"%"]})]})}),s.jsx(x,{span:12,children:s.jsxs(y,{size:"small",title:"Queries",children:[s.jsx(j,{value:M.query_count,suffix:"open"}),s.jsxs(q,{type:"secondary",children:["Resolution Rate: ",null==(L=M.query_resolution_rate)?void 0:L.toFixed(1),"%"]})]})})]})})},{key:"source-files",label:s.jsxs("span",{children:[s.jsx(S,{})," Source Files",s.jsx(b,{count:Q.filter(e=>"loaded"===e.status).length,style:{marginLeft:8,backgroundColor:"#52c41a"},showZero:!0})]}),children:s.jsxs("div",{children:[s.jsx(q,{type:"secondary",style:{display:"block",marginBottom:16},children:"Excel files processed for this study from the QC Anonymized Study Files folder"}),s.jsx(v,{dataSource:Q,rowKey:"file_type",loading:T,pagination:!1,columns:[{title:"File Type",dataIndex:"display_name",key:"display_name",render:e=>s.jsx(q,{strong:!0,children:e})},{title:"Status",dataIndex:"status",key:"status",render:e=>"loaded"===e?s.jsx(c,{icon:s.jsx(f,{}),color:"success",children:"Loaded"}):s.jsx(c,{icon:s.jsx(g,{}),color:"default",children:"Not Found"})},{title:"Records",dataIndex:"record_count",key:"record_count",render:(e,t)=>"loaded"===t.status?s.jsx(q,{children:e.toLocaleString()}):s.jsx(q,{type:"secondary",children:"-"})},{title:"Loaded At",dataIndex:"loaded_at",key:"loaded_at",render:e=>e?s.jsx(q,{type:"secondary",children:new Date(e).toLocaleString()}):s.jsx(q,{type:"secondary",children:"-"})}]})]})},{key:"patients",label:"Patients",children:s.jsxs(q,{children:["Patient list for ",C]})},{key:"sites",label:"Sites",children:s.jsxs(q,{children:["Site list for ",C]})},{key:"metrics",label:"Metrics",children:s.jsxs(q,{children:["Detailed metrics for ",C]})}]})})]}):s.jsxs("div",{children:[s.jsx(l,{items:[{href:"/",title:s.jsx(r,{})},{title:s.jsxs(s.Fragment,{children:[s.jsx(n,{})," Studies"]})}],style:{marginBottom:16}}),s.jsx(k,{level:2,children:"Studies"}),s.jsx(q,{type:"secondary",style:{display:"block",marginBottom:24},children:"Overview of all clinical studies and their data quality metrics"}),s.jsx(y,{children:s.jsx(v,{columns:O,dataSource:P,rowKey:"study_id",loading:z,pagination:{pageSize:10}})})]})}export{F as default};
