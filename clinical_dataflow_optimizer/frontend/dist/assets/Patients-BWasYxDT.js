import{r as e,u as t,j as s}from"./vendor-query-3cLbHxHt.js";import{u as i,p as l}from"./index-CLsPU1EI.js";import{c as a,u as n}from"./vendor-react-BULyYbn8.js";import{b2 as r,u as c,c as o,q as d,F as u,G as x,E as h,aH as j,p as y,m,S as p,b7 as _,i as g,b5 as v,b8 as f,b9 as S,H as C,P as b,N as k,I,B as w}from"./vendor-antd-CMNZCwNL.js";import"./vendor-state-hAMrnFl_.js";const{Title:q,Text:P}=d,{Search:D}=_,z={critical:"red",high:"orange",medium:"gold",low:"green"};function F(){const{patientId:d}=a();n();const{selectedStudyId:_}=i(),[F,B]=e.useState(""),[L,K]=e.useState(null),[T,A]=e.useState(!1),[M,V]=e.useState(null),{data:H=[],isLoading:O}=t({queryKey:["patients",_,L],queryFn:()=>l.getAll({study_id:_||void 0,status:L||void 0})}),{data:Q}=t({queryKey:["patientCleanStatus",null==M?void 0:M.patient_id],queryFn:()=>l.getCleanStatus(M.patient_id),enabled:!!M}),{data:E=[]}=t({queryKey:["dirtyPatients",_],queryFn:()=>l.getDirtyPatients(_||void 0)}),G=H.filter(e=>{var t;return e.patient_id.toLowerCase().includes(F.toLowerCase())||(null==(t=e.site_id)?void 0:t.toLowerCase().includes(F.toLowerCase()))}),N=e=>{V(e),A(!0)},R=[{title:"Patient ID",dataIndex:"patient_id",key:"patient_id",render:(e,t)=>s.jsx("a",{onClick:()=>N(t),children:e}),sorter:(e,t)=>e.patient_id.localeCompare(t.patient_id)},{title:"Study",dataIndex:"study_id",key:"study_id",render:e=>s.jsx(C,{children:e})},{title:"Site",dataIndex:"site_id",key:"site_id"},{title:"Status",key:"clean_status",render:(e,t)=>s.jsx(p,{children:t.is_clean?s.jsx(C,{icon:s.jsx(y,{}),color:"success",children:"Clean"}):s.jsx(C,{icon:s.jsx(m,{}),color:"error",children:"Dirty"})}),filters:[{text:"Clean",value:"clean"},{text:"Dirty",value:"dirty"}],onFilter:(e,t)=>"clean"===e?t.is_clean:!t.is_clean},{title:"Cleanliness Score",dataIndex:"cleanliness_score",key:"cleanliness_score",render:e=>s.jsx(b,{percent:Math.round(e||0),size:"small",status:e>=80?"success":e>=60?"normal":"exception"}),sorter:(e,t)=>(e.cleanliness_score||0)-(t.cleanliness_score||0)},{title:"Visits",dataIndex:"visit_count",key:"visit_count",sorter:(e,t)=>(e.visit_count||0)-(t.visit_count||0)},{title:"Open Queries",dataIndex:"query_count",key:"query_count",render:e=>s.jsx("span",{style:{color:e>0?"#ff4d4f":"#52c41a"},children:e||0}),sorter:(e,t)=>(e.query_count||0)-(t.query_count||0)},{title:"Actions",key:"actions",render:(e,t)=>s.jsx(w,{type:"link",size:"small",onClick:()=>N(t),children:"View Details"})}];return s.jsxs("div",{children:[s.jsx(r,{items:[{href:"/",title:s.jsx(c,{})},{title:s.jsxs(s.Fragment,{children:[s.jsx(o,{})," Patients"]})}],style:{marginBottom:16}}),s.jsx(q,{level:2,children:"Patients"}),s.jsx(P,{type:"secondary",style:{display:"block",marginBottom:24},children:"Patient cleanliness status and data quality overview"}),s.jsxs(u,{gutter:[24,24],style:{marginBottom:24},children:[s.jsx(x,{xs:24,sm:12,md:6,children:s.jsx(h,{children:s.jsx(j,{title:"Total Patients",value:H.length,prefix:s.jsx(o,{})})})}),s.jsx(x,{xs:24,sm:12,md:6,children:s.jsx(h,{children:s.jsx(j,{title:"Clean Patients",value:H.filter(e=>e.is_clean).length,valueStyle:{color:"#52c41a"},prefix:s.jsx(y,{})})})}),s.jsx(x,{xs:24,sm:12,md:6,children:s.jsx(h,{children:s.jsx(j,{title:"Dirty Patients",value:E.length,valueStyle:{color:"#ff4d4f"},prefix:s.jsx(m,{})})})}),s.jsx(x,{xs:24,sm:12,md:6,children:s.jsx(h,{children:s.jsx(j,{title:"Clean Rate",value:H.length>0?(H.filter(e=>e.is_clean).length/H.length*100).toFixed(1):0,suffix:"%",valueStyle:{color:H.filter(e=>e.is_clean).length/H.length>=.8?"#52c41a":"#faad14"}})})})]}),s.jsx(h,{style:{marginBottom:24},children:s.jsxs(p,{wrap:!0,children:[s.jsx(D,{placeholder:"Search patients...",allowClear:!0,onSearch:B,onChange:e=>B(e.target.value),style:{width:250}}),s.jsx(g,{placeholder:"Status",allowClear:!0,style:{width:150},onChange:K,options:[{value:"clean",label:"Clean"},{value:"dirty",label:"Dirty"}]})]})}),s.jsx(h,{children:s.jsx(v,{columns:R,dataSource:G,rowKey:"patient_id",loading:O,pagination:{pageSize:15,showSizeChanger:!0}})}),s.jsx(f,{title:`Patient: ${null==M?void 0:M.patient_id}`,placement:"right",width:600,open:T,onClose:()=>{A(!1),V(null)},children:M&&s.jsxs(p,{direction:"vertical",size:"large",style:{width:"100%"},children:[s.jsxs(S,{bordered:!0,column:1,size:"small",children:[s.jsx(S.Item,{label:"Patient ID",children:M.patient_id}),s.jsx(S.Item,{label:"Study",children:M.study_id}),s.jsx(S.Item,{label:"Site",children:M.site_id}),s.jsx(S.Item,{label:"Status",children:M.is_clean?s.jsx(C,{color:"success",children:"Clean"}):s.jsx(C,{color:"error",children:"Dirty"})}),s.jsx(S.Item,{label:"Cleanliness Score",children:s.jsx(b,{percent:Math.round(M.cleanliness_score||0),status:M.cleanliness_score>=80?"success":"exception"})}),s.jsx(S.Item,{label:"Visits",children:M.visit_count}),s.jsx(S.Item,{label:"Open Queries",children:M.query_count})]}),Q&&s.jsxs(h,{title:"Clean Patient Status Details",size:"small",extra:s.jsx(C,{color:Q.is_clean?"success":"error",children:Q.lock_readiness}),children:[s.jsxs(P,{type:"secondary",children:["Last checked: ",Q.last_checked]}),Q.blocking_factors&&Q.blocking_factors.length>0&&s.jsxs("div",{style:{marginTop:16},children:[s.jsxs(P,{strong:!0,style:{display:"block",marginBottom:8},children:[s.jsx(k,{style:{color:"#faad14"}})," Blocking Factors (",Q.blocking_factors.length,")"]}),s.jsx(I,{size:"small",dataSource:Q.blocking_factors,renderItem:e=>s.jsx(I.Item,{children:s.jsx(I.Item.Meta,{avatar:s.jsx(C,{color:z[e.severity],children:e.severity}),title:e.factor_type,description:s.jsxs(s.Fragment,{children:[s.jsx(P,{children:e.description}),s.jsx("br",{}),s.jsxs(P,{type:"secondary",style:{fontSize:12},children:["Domain: ",e.domain," | Action: ",e.resolution_action]})]})})})})]})]})]})})]})}export{F as default};
