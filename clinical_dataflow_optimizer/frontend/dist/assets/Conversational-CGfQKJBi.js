import{r as e,b as s,j as t}from"./vendor-query-3cLbHxHt.js";import{u as i}from"./index-ByULtmE-.js";import{bh as n,L as r,q as l,f as a,S as o,N as d,O as c,A as x,c as p,V as h,Q as y,aV as g,B as u,z as m,bc as j,bi as f}from"./vendor-antd-Ba3TCcI4.js";import"./vendor-react-CSmESBJ6.js";import"./vendor-state-hAMrnFl_.js";const{Content:v}=r,{Title:b,Text:w,Paragraph:S}=l,{TextArea:C}=j,k=()=>{const[r,l]=e.useState([]),[j,k]=e.useState(""),[_,z]=e.useState(!1),[q,A]=e.useState(null),R=e.useRef(null),T=i(e=>e.selectedStudyId);e.useEffect(()=>{var e;null==(e=R.current)||e.scrollIntoView({behavior:"smooth"})},[r]),e.useEffect(()=>{B()},[T]);const B=async()=>{try{const e=await s.post("/api/conversational/session/start",{study_id:T||void 0});A(e.data.session_id),l([]),n.success("Conversation session started")}catch(e){n.error("Failed to start conversation session")}},I=async e=>{if(!e.trim()||!q)return;z(!0);const t={id:Date.now().toString(),type:"user",content:e,timestamp:new Date};l(e=>[...e,t]),k("");try{const t=(await s.post("/api/conversational/query",{query:e,session_id:q,study_id:T||void 0})).data,i={id:(Date.now()+1).toString(),type:"assistant",content:t.answer,timestamp:new Date,response:t};l(e=>[...e,i])}catch(i){n.error("Failed to process query")}finally{z(!1)}},D=()=>{j.trim()&&I(j)},F=e=>{switch(e){case"critical":return"red";case"high":return"orange";case"warning":return"gold";default:return"blue"}};return t.jsx(v,{style:{padding:"24px",minHeight:"100vh"},children:t.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[t.jsxs(b,{level:2,children:[t.jsx(a,{style:{marginRight:"12px"}}),"Knowledge Graph Chatbot"]}),t.jsx(S,{children:"Ask questions about clinical trial data in natural language. The chatbot uses the study knowledge graph and LongCat reasoning to provide grounded answers."}),t.jsxs(o,{size:"middle",style:{marginBottom:"16px"},children:[t.jsxs(d,{color:"blue",children:["Knowledge Graph: ",T||"All Studies"]}),t.jsx(d,{color:"green",children:"LongCat Reasoning Enabled"})]}),t.jsxs("div",{style:{display:"flex",gap:"24px",height:"calc(100vh - 200px)"},children:[t.jsx("div",{style:{flex:2,display:"flex",flexDirection:"column"},children:t.jsxs(c,{title:"Conversation",style:{flex:1,display:"flex",flexDirection:"column"},bodyStyle:{flex:1,display:"flex",flexDirection:"column",padding:"16px"},children:[t.jsxs("div",{style:{flex:1,overflowY:"auto",marginBottom:"16px",padding:"8px",border:"1px solid #f0f0f0",borderRadius:"4px",backgroundColor:"#fafafa"},children:[0===r.length&&t.jsxs("div",{style:{textAlign:"center",color:"#999",padding:"40px"},children:[t.jsx(a,{style:{fontSize:"48px",marginBottom:"16px"}}),t.jsx("div",{children:"Start a conversation by asking a question about clinical trial data."})]}),r.map(e=>t.jsx("div",{style:{marginBottom:"16px",display:"flex",justifyContent:"user"===e.type?"flex-end":"flex-start"},children:t.jsxs("div",{style:{maxWidth:"70%",padding:"12px 16px",borderRadius:"8px",backgroundColor:"user"===e.type?"#1890ff":"#f6f6f6",color:"user"===e.type?"white":"black",border:"user"===e.type?"none":"1px solid #e8e8e8"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"},children:[t.jsx(x,{size:"small",icon:"user"===e.type?t.jsx(p,{}):t.jsx(a,{}),style:{marginRight:"8px"}}),t.jsx(w,{strong:!0,style:{color:"user"===e.type?"white":"black"},children:"user"===e.type?"You":"AI Assistant"}),t.jsx(w,{type:"secondary",style:{fontSize:"12px",marginLeft:"8px",color:"user"===e.type?"rgba(255,255,255,0.8)":"#999"},children:e.timestamp.toLocaleTimeString()})]}),t.jsx("div",{style:{marginBottom:"8px"},children:e.content}),"assistant"===e.type&&e.response&&t.jsxs("div",{children:[e.response.insights.length>0&&t.jsxs("div",{style:{marginTop:"12px"},children:[t.jsxs(w,{strong:!0,style:{fontSize:"14px",marginBottom:"8px",display:"block"},children:[t.jsx(h,{style:{marginRight:"4px"}}),"Key Insights:"]}),t.jsx(y,{size:"small",dataSource:e.response.insights,renderItem:e=>t.jsx(y.Item,{style:{padding:"8px 0"},children:t.jsxs("div",{style:{width:"100%"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"},children:[t.jsx(d,{color:F(e.severity),style:{marginRight:"8px"},children:e.severity.toUpperCase()}),t.jsx(w,{strong:!0,children:e.title})]}),t.jsx(w,{children:e.description}),e.confidence&&t.jsx("div",{style:{marginTop:"4px"},children:t.jsxs(w,{type:"secondary",style:{fontSize:"12px"},children:["Confidence: ",(100*e.confidence).toFixed(0),"%"]})})]})})})]}),e.response.follow_up_questions.length>0&&t.jsxs("div",{style:{marginTop:"12px"},children:[t.jsxs(w,{strong:!0,style:{fontSize:"14px",marginBottom:"8px",display:"block"},children:[t.jsx(g,{style:{marginRight:"4px"}}),"Suggested Follow-ups:"]}),t.jsx(o,{wrap:!0,children:e.response.follow_up_questions.map((e,s)=>t.jsx(u,{type:"link",size:"small",onClick:()=>(e=>{I(e)})(e),children:e},s))})]}),t.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"#999"},children:["Processing: ",e.response.processing_time_ms.toFixed(0),"ms | Confidence: ",(100*e.response.confidence).toFixed(0),"%"]})]})]})},e.id)),_&&t.jsxs("div",{style:{textAlign:"center",padding:"20px"},children:[t.jsx(m,{size:"large"}),t.jsx("div",{style:{marginTop:"8px",color:"#999"},children:"Analyzing your query..."})]}),t.jsx("div",{ref:R})]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx(C,{value:j,onChange:e=>k(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),D())},placeholder:"Ask a question about clinical trial data...",autoSize:{minRows:1,maxRows:4},style:{flex:1},disabled:_}),t.jsx(u,{type:"primary",icon:t.jsx(f,{}),onClick:D,loading:_,disabled:!j.trim()||_,children:"Send"})]})]})}),t.jsxs("div",{style:{flex:1},children:[t.jsx(c,{title:"Capabilities",style:{marginBottom:"16px"},children:t.jsx(y,{size:"small",dataSource:["Natural language understanding","Multi-turn conversations","RAG-powered insights","Cross-dataset analysis","Trend analysis","Correlation detection"],renderItem:e=>t.jsx(y.Item,{children:e})})}),t.jsx(c,{title:"Example Queries",children:t.jsx(o,{direction:"vertical",style:{width:"100%"},children:["Show me sites with high missing visits","What are the top 5 sites by open queries?","Find correlations between metrics","Show me patients with SAE issues","Analyze trends in data quality","Find sites with protocol deviations"].map((e,s)=>t.jsx(u,{type:"link",block:!0,style:{textAlign:"left"},onClick:()=>I(e),disabled:_,children:e},s))})}),t.jsx(c,{title:"Supported Metrics",style:{marginTop:"16px"},children:t.jsxs(o,{wrap:!0,children:[t.jsx(d,{children:"missing_visits"}),t.jsx(d,{children:"open_queries"}),t.jsx(d,{children:"data_quality_index"}),t.jsx(d,{children:"sae_count"}),t.jsx(d,{children:"uncoded_terms"}),t.jsx(d,{children:"frozen_crfs"}),t.jsx(d,{children:"locked_crfs"})]})})]})]})]})})};export{k as default};
