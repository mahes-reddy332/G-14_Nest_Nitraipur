import{e,r as t,u as s,f as l,j as r}from"./vendor-query-3cLbHxHt.js";import{a}from"./index-ByULtmE-.js";import{bf as i,N as n,T as o,E as d,S as c,B as u,b8 as x,u as h,e as y,q as j,J as m,K as v,O as g,aJ as p,m as f,v as C,p as S,i as w,ba as _,aO as b,aP as k,bg as A,bc as q,I,bh as T}from"./vendor-antd-Ba3TCcI4.js";import{r as K}from"./relativeTime-myFe_gQo.js";import"./vendor-react-CSmESBJ6.js";import"./vendor-state-hAMrnFl_.js";d.extend(K);const{Title:F,Text:O,Paragraph:Y}=j,{TextArea:D}=q,R={critical:{color:"#ff4d4f",icon:r.jsx(y,{}),tagColor:"red"},high:{color:"#fa8c16",icon:r.jsx(C,{}),tagColor:"orange"},medium:{color:"#faad14",icon:r.jsx(I,{}),tagColor:"gold"},low:{color:"#52c41a",icon:r.jsx(S,{}),tagColor:"green"}},z={new:"red",acknowledged:"orange",in_progress:"blue",resolved:"green",dismissed:"default"},B={data_quality:"Data Quality",safety:"Safety",operational:"Operational",compliance:"Compliance",system:"System"};function H(){var j,q,I,K,H,P,Q;const U=e(),[M,N]=t.useState("active"),[E,$]=t.useState(null),[J,L]=t.useState(null),[G,V]=t.useState(null),[W,X]=t.useState(null),[Z,ee]=t.useState(!1),[te,se]=t.useState(!1),[le]=i.useForm(),{data:re=[],isLoading:ae}=s({queryKey:["alerts",E,J,G],queryFn:()=>a.getAll({status:E||void 0,severity:J||void 0,category:G||void 0})}),{data:ie}=s({queryKey:["alertSummary"],queryFn:a.getSummary}),{data:ne=[]}=s({queryKey:["criticalAlerts"],queryFn:a.getCritical}),oe=l({mutationFn:({alertId:e,user:t})=>a.acknowledge(e,t),onSuccess:()=>{U.invalidateQueries({queryKey:["alerts"]}),U.invalidateQueries({queryKey:["alertSummary"]}),T.success("Alert acknowledged")}}),de=l({mutationFn:({alertId:e,user:t,notes:s})=>a.resolve(e,t,s),onSuccess:()=>{U.invalidateQueries({queryKey:["alerts"]}),U.invalidateQueries({queryKey:["alertSummary"]}),T.success("Alert resolved"),se(!1),le.resetFields()}}),ce=[{title:"Severity",dataIndex:"severity",key:"severity",width:100,render:e=>{const t=R[e];return r.jsx(n,{icon:null==t?void 0:t.icon,color:null==t?void 0:t.tagColor,children:e})},filters:Object.entries(R).map(([e])=>({text:e.charAt(0).toUpperCase()+e.slice(1),value:e})),onFilter:(e,t)=>t.severity===e},{title:"Title",dataIndex:"title",key:"title",render:(e,t)=>r.jsx("a",{onClick:()=>(X(t),void ee(!0)),children:e})},{title:"Category",dataIndex:"category",key:"category",render:e=>r.jsx(n,{children:B[e]||e}),filters:Object.entries(B).map(([e,t])=>({text:t,value:e})),onFilter:(e,t)=>t.category===e},{title:"Status",dataIndex:"status",key:"status",render:e=>r.jsx(n,{color:z[e],children:e.replace("_"," ")})},{title:"Created",dataIndex:"created_at",key:"created_at",render:e=>r.jsx(o,{title:d(e).format("YYYY-MM-DD HH:mm:ss"),children:r.jsx("span",{children:d(e).fromNow()})}),sorter:(e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()},{title:"Actions",key:"actions",width:200,render:(e,t)=>r.jsxs(c,{children:["new"===t.status&&r.jsx(u,{type:"primary",size:"small",onClick:()=>{return e=t,void oe.mutate({alertId:e.alert_id,user:"Current User"});var e},loading:oe.isPending,children:"Acknowledge"}),["new","acknowledged","in_progress"].includes(t.status)&&r.jsx(u,{size:"small",onClick:()=>{X(t),se(!0)},children:"Resolve"})]})}],ue=re.filter(e=>!["resolved","dismissed"].includes(e.status)),xe=re.filter(e=>["resolved","dismissed"].includes(e.status));return r.jsxs("div",{children:[r.jsx(x,{items:[{href:"/",title:r.jsx(h,{})},{title:r.jsxs(r.Fragment,{children:[r.jsx(y,{})," Alerts"]})}],style:{marginBottom:16}}),r.jsx(F,{level:2,children:"Alerts"}),r.jsx(O,{type:"secondary",style:{display:"block",marginBottom:24},children:"Real-time alerts and notifications for data quality and operational issues"}),r.jsxs(m,{gutter:[24,24],style:{marginBottom:24},children:[r.jsx(v,{xs:24,sm:12,md:6,children:r.jsx(g,{children:r.jsx(p,{title:"Total Active",value:(null==ie?void 0:ie.active_alerts)||0,prefix:r.jsx(y,{})})})}),r.jsx(v,{xs:24,sm:12,md:6,children:r.jsx(g,{children:r.jsx(p,{title:"Critical",value:(null==(j=null==ie?void 0:ie.by_severity)?void 0:j.critical)||0,valueStyle:{color:"#ff4d4f"},prefix:r.jsx(f,{})})})}),r.jsx(v,{xs:24,sm:12,md:6,children:r.jsx(g,{children:r.jsx(p,{title:"High Priority",value:(null==(q=null==ie?void 0:ie.by_severity)?void 0:q.high)||0,valueStyle:{color:"#fa8c16"},prefix:r.jsx(C,{})})})}),r.jsx(v,{xs:24,sm:12,md:6,children:r.jsx(g,{children:r.jsx(p,{title:"Resolved Today",value:(null==(I=null==ie?void 0:ie.by_status)?void 0:I.resolved)||0,valueStyle:{color:"#52c41a"},prefix:r.jsx(S,{})})})})]}),r.jsx(g,{style:{marginBottom:24},children:r.jsxs(c,{wrap:!0,children:[r.jsx(w,{placeholder:"Severity",allowClear:!0,style:{width:150},onChange:L,options:Object.keys(R).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)}))}),r.jsx(w,{placeholder:"Category",allowClear:!0,style:{width:150},onChange:V,options:Object.entries(B).map(([e,t])=>({value:e,label:t}))}),r.jsx(w,{placeholder:"Status",allowClear:!0,style:{width:150},onChange:$,options:Object.keys(z).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}))})]})}),r.jsx(g,{children:r.jsx(_,{activeKey:M,onChange:N,items:[{key:"active",label:`Active (${ue.length})`,children:r.jsx(b,{columns:ce,dataSource:ue,rowKey:"alert_id",loading:ae,pagination:{pageSize:10}})},{key:"critical",label:r.jsxs("span",{children:["Critical"," ",ne.length>0&&r.jsx(n,{color:"red",children:ne.length})]}),children:r.jsx(b,{columns:ce,dataSource:ne,rowKey:"alert_id",loading:ae,pagination:{pageSize:10}})},{key:"resolved",label:`Resolved (${xe.length})`,children:r.jsx(b,{columns:ce,dataSource:xe,rowKey:"alert_id",loading:ae,pagination:{pageSize:10}})}]})}),r.jsx(k,{title:`Alert: ${null==W?void 0:W.title}`,open:Z,onCancel:()=>ee(!1),footer:null,width:600,children:W&&r.jsxs(c,{direction:"vertical",size:"large",style:{width:"100%"},children:[r.jsxs(m,{gutter:16,children:[r.jsx(v,{span:8,children:r.jsx(n,{icon:null==(K=R[W.severity])?void 0:K.icon,color:null==(H=R[W.severity])?void 0:H.tagColor,children:W.severity})}),r.jsx(v,{span:8,children:r.jsx(n,{color:z[W.status],children:W.status.replace("_"," ")})}),r.jsx(v,{span:8,children:r.jsx(n,{children:B[W.category]})})]}),r.jsx(Y,{children:W.description}),r.jsxs("div",{children:[r.jsx(O,{strong:!0,children:"Source: "}),r.jsx(O,{children:W.source})]}),r.jsxs("div",{children:[r.jsx(O,{strong:!0,children:"Affected Entity: "}),r.jsxs(O,{children:[null==(P=W.affected_entity)?void 0:P.type,": ",null==(Q=W.affected_entity)?void 0:Q.id]})]}),r.jsxs("div",{children:[r.jsx(O,{strong:!0,children:"Created: "}),r.jsx(O,{children:d(W.created_at).format("YYYY-MM-DD HH:mm:ss")})]}),W.actions_taken&&W.actions_taken.length>0&&r.jsxs("div",{children:[r.jsx(O,{strong:!0,children:"Actions Taken:"}),r.jsx(A,{style:{marginTop:8},children:W.actions_taken.map((e,t)=>r.jsxs(A.Item,{children:[e.action," - ",e.performed_by," (",d(e.performed_at).fromNow(),")"]},t))})]})]})}),r.jsx(k,{title:"Resolve Alert",open:te,onCancel:()=>se(!1),footer:null,children:r.jsxs(i,{form:le,onFinish:e=>{W&&de.mutate({alertId:W.alert_id,user:"Current User",notes:e.notes})},layout:"vertical",children:[r.jsx(i.Item,{name:"notes",label:"Resolution Notes",children:r.jsx(D,{rows:4,placeholder:"Enter resolution notes..."})}),r.jsx(i.Item,{children:r.jsxs(c,{children:[r.jsx(u,{type:"primary",htmlType:"submit",loading:de.isPending,children:"Resolve"}),r.jsx(u,{onClick:()=>se(!1),children:"Cancel"})]})})]})})]})}export{H as default};
