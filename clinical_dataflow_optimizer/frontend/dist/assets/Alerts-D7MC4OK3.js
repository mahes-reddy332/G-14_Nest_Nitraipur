import{e,r as t,u as s,f as l,j as r}from"./vendor-query-3cLbHxHt.js";import{a}from"./index-CLsPU1EI.js";import{ba as i,H as n,T as o,J as d,S as c,B as u,b2 as x,u as y,e as h,q as j,F as m,G as v,E as g,aH as p,m as f,v as C,p as S,i as b,b4 as w,b5 as _,bb as k,bc as A,b7 as q,K as T,bd as F}from"./vendor-antd-CMNZCwNL.js";import{r as I}from"./relativeTime-myFe_gQo.js";import"./vendor-react-BULyYbn8.js";import"./vendor-state-hAMrnFl_.js";d.extend(I);const{Title:K,Text:Y,Paragraph:D}=j,{TextArea:H}=q,R={critical:{color:"#ff4d4f",icon:r.jsx(h,{}),tagColor:"red"},high:{color:"#fa8c16",icon:r.jsx(C,{}),tagColor:"orange"},medium:{color:"#faad14",icon:r.jsx(T,{}),tagColor:"gold"},low:{color:"#52c41a",icon:r.jsx(S,{}),tagColor:"green"}},z={new:"red",acknowledged:"orange",in_progress:"blue",resolved:"green",dismissed:"default"},O={data_quality:"Data Quality",safety:"Safety",operational:"Operational",compliance:"Compliance",system:"System"};function B(){var j,q,T,I,B,Q,U;const M=e(),[P,E]=t.useState("active"),[N,$]=t.useState(null),[G,J]=t.useState(null),[L,V]=t.useState(null),[W,X]=t.useState(null),[Z,ee]=t.useState(!1),[te,se]=t.useState(!1),[le]=i.useForm(),{data:re=[],isLoading:ae}=s({queryKey:["alerts",N,G,L],queryFn:()=>a.getAll({status:N||void 0,severity:G||void 0,category:L||void 0})}),{data:ie}=s({queryKey:["alertSummary"],queryFn:a.getSummary}),{data:ne=[]}=s({queryKey:["criticalAlerts"],queryFn:a.getCritical}),oe=l({mutationFn:({alertId:e,user:t})=>a.acknowledge(e,t),onSuccess:()=>{M.invalidateQueries({queryKey:["alerts"]}),M.invalidateQueries({queryKey:["alertSummary"]}),F.success("Alert acknowledged")}}),de=l({mutationFn:({alertId:e,user:t,notes:s})=>a.resolve(e,t,s),onSuccess:()=>{M.invalidateQueries({queryKey:["alerts"]}),M.invalidateQueries({queryKey:["alertSummary"]}),F.success("Alert resolved"),se(!1),le.resetFields()}}),ce=[{title:"Severity",dataIndex:"severity",key:"severity",width:100,render:e=>{const t=R[e];return r.jsx(n,{icon:null==t?void 0:t.icon,color:null==t?void 0:t.tagColor,children:e})},filters:Object.entries(R).map(([e])=>({text:e.charAt(0).toUpperCase()+e.slice(1),value:e})),onFilter:(e,t)=>t.severity===e},{title:"Title",dataIndex:"title",key:"title",render:(e,t)=>r.jsx("a",{onClick:()=>(X(t),void ee(!0)),children:e})},{title:"Category",dataIndex:"category",key:"category",render:e=>r.jsx(n,{children:O[e]||e}),filters:Object.entries(O).map(([e,t])=>({text:t,value:e})),onFilter:(e,t)=>t.category===e},{title:"Status",dataIndex:"status",key:"status",render:e=>r.jsx(n,{color:z[e],children:e.replace("_"," ")})},{title:"Created",dataIndex:"created_at",key:"created_at",render:e=>r.jsx(o,{title:d(e).format("YYYY-MM-DD HH:mm:ss"),children:r.jsx("span",{children:d(e).fromNow()})}),sorter:(e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()},{title:"Actions",key:"actions",width:200,render:(e,t)=>r.jsxs(c,{children:["new"===t.status&&r.jsx(u,{type:"primary",size:"small",onClick:()=>{return e=t,void oe.mutate({alertId:e.alert_id,user:"Current User"});var e},loading:oe.isPending,children:"Acknowledge"}),["new","acknowledged","in_progress"].includes(t.status)&&r.jsx(u,{size:"small",onClick:()=>{X(t),se(!0)},children:"Resolve"})]})}],ue=re.filter(e=>!["resolved","dismissed"].includes(e.status)),xe=re.filter(e=>["resolved","dismissed"].includes(e.status));return r.jsxs("div",{children:[r.jsx(x,{items:[{href:"/",title:r.jsx(y,{})},{title:r.jsxs(r.Fragment,{children:[r.jsx(h,{})," Alerts"]})}],style:{marginBottom:16}}),r.jsx(K,{level:2,children:"Alerts"}),r.jsx(Y,{type:"secondary",style:{display:"block",marginBottom:24},children:"Real-time alerts and notifications for data quality and operational issues"}),r.jsxs(m,{gutter:[24,24],style:{marginBottom:24},children:[r.jsx(v,{xs:24,sm:12,md:6,children:r.jsx(g,{children:r.jsx(p,{title:"Total Active",value:(null==ie?void 0:ie.active_alerts)||0,prefix:r.jsx(h,{})})})}),r.jsx(v,{xs:24,sm:12,md:6,children:r.jsx(g,{children:r.jsx(p,{title:"Critical",value:(null==(j=null==ie?void 0:ie.by_severity)?void 0:j.critical)||0,valueStyle:{color:"#ff4d4f"},prefix:r.jsx(f,{})})})}),r.jsx(v,{xs:24,sm:12,md:6,children:r.jsx(g,{children:r.jsx(p,{title:"High Priority",value:(null==(q=null==ie?void 0:ie.by_severity)?void 0:q.high)||0,valueStyle:{color:"#fa8c16"},prefix:r.jsx(C,{})})})}),r.jsx(v,{xs:24,sm:12,md:6,children:r.jsx(g,{children:r.jsx(p,{title:"Resolved Today",value:(null==(T=null==ie?void 0:ie.by_status)?void 0:T.resolved)||0,valueStyle:{color:"#52c41a"},prefix:r.jsx(S,{})})})})]}),r.jsx(g,{style:{marginBottom:24},children:r.jsxs(c,{wrap:!0,children:[r.jsx(b,{placeholder:"Severity",allowClear:!0,style:{width:150},onChange:J,options:Object.keys(R).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)}))}),r.jsx(b,{placeholder:"Category",allowClear:!0,style:{width:150},onChange:V,options:Object.entries(O).map(([e,t])=>({value:e,label:t}))}),r.jsx(b,{placeholder:"Status",allowClear:!0,style:{width:150},onChange:$,options:Object.keys(z).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}))})]})}),r.jsx(g,{children:r.jsx(w,{activeKey:P,onChange:E,items:[{key:"active",label:`Active (${ue.length})`,children:r.jsx(_,{columns:ce,dataSource:ue,rowKey:"alert_id",loading:ae,pagination:{pageSize:10}})},{key:"critical",label:r.jsxs("span",{children:["Critical"," ",ne.length>0&&r.jsx(n,{color:"red",children:ne.length})]}),children:r.jsx(_,{columns:ce,dataSource:ne,rowKey:"alert_id",loading:ae,pagination:{pageSize:10}})},{key:"resolved",label:`Resolved (${xe.length})`,children:r.jsx(_,{columns:ce,dataSource:xe,rowKey:"alert_id",loading:ae,pagination:{pageSize:10}})}]})}),r.jsx(k,{title:`Alert: ${null==W?void 0:W.title}`,open:Z,onCancel:()=>ee(!1),footer:null,width:600,children:W&&r.jsxs(c,{direction:"vertical",size:"large",style:{width:"100%"},children:[r.jsxs(m,{gutter:16,children:[r.jsx(v,{span:8,children:r.jsx(n,{icon:null==(I=R[W.severity])?void 0:I.icon,color:null==(B=R[W.severity])?void 0:B.tagColor,children:W.severity})}),r.jsx(v,{span:8,children:r.jsx(n,{color:z[W.status],children:W.status.replace("_"," ")})}),r.jsx(v,{span:8,children:r.jsx(n,{children:O[W.category]})})]}),r.jsx(D,{children:W.description}),r.jsxs("div",{children:[r.jsx(Y,{strong:!0,children:"Source: "}),r.jsx(Y,{children:W.source})]}),r.jsxs("div",{children:[r.jsx(Y,{strong:!0,children:"Affected Entity: "}),r.jsxs(Y,{children:[null==(Q=W.affected_entity)?void 0:Q.type,": ",null==(U=W.affected_entity)?void 0:U.id]})]}),r.jsxs("div",{children:[r.jsx(Y,{strong:!0,children:"Created: "}),r.jsx(Y,{children:d(W.created_at).format("YYYY-MM-DD HH:mm:ss")})]}),W.actions_taken&&W.actions_taken.length>0&&r.jsxs("div",{children:[r.jsx(Y,{strong:!0,children:"Actions Taken:"}),r.jsx(A,{style:{marginTop:8},children:W.actions_taken.map((e,t)=>r.jsxs(A.Item,{children:[e.action," - ",e.performed_by," (",d(e.performed_at).fromNow(),")"]},t))})]})]})}),r.jsx(k,{title:"Resolve Alert",open:te,onCancel:()=>se(!1),footer:null,children:r.jsxs(i,{form:le,onFinish:e=>{W&&de.mutate({alertId:W.alert_id,user:"Current User",notes:e.notes})},layout:"vertical",children:[r.jsx(i.Item,{name:"notes",label:"Resolution Notes",children:r.jsx(H,{rows:4,placeholder:"Enter resolution notes..."})}),r.jsx(i.Item,{children:r.jsxs(c,{children:[r.jsx(u,{type:"primary",htmlType:"submit",loading:de.isPending,children:"Resolve"}),r.jsx(u,{onClick:()=>se(!1),children:"Cancel"})]})})]})})]})}export{B as default};
