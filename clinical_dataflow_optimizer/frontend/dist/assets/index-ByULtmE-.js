const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-CiOe9L3-.js","assets/vendor-query-3cLbHxHt.js","assets/vendor-antd-Ba3TCcI4.js","assets/relativeTime-myFe_gQo.js","assets/vendor-react-CSmESBJ6.js","assets/vendor-state-hAMrnFl_.js","assets/Studies-CKMbmS3U.js","assets/Patients-Cn2mWvge.js","assets/Sites-CzSm8W8P.js","assets/Alerts-Cc1w_COO.js","assets/Agents-BPZDgtwD.js","assets/Conversational-CGfQKJBi.js","assets/Reports-CFW_azQv.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,s)=>((t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s)(t,"symbol"!=typeof a?a+"":a,s);import{j as a,b as s,u as r,r as n,Q as i,R as o,d as c}from"./vendor-query-3cLbHxHt.js";import{r as l,L as d,R as u,M as y,a as p,b as _,c as m,d as g,e as h,f,g as x,h as v,S as w,i as b,T as j,B as S,j as k,k as R,l as C,D as E,A as I,m as A,n as q,o as D,p as T,q as O,s as L,t as N,u as P,v as $,w as z,x as U,y as B,_ as M,z as Q,C as W}from"./vendor-antd-Ba3TCcI4.js";import{u as F,a as H,B as V,R as G,b as K,N as J}from"./vendor-react-CSmESBJ6.js";import{c as X}from"./vendor-state-hAMrnFl_.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Y={},Z=l;Y.createRoot=Z.createRoot,Y.hydrateRoot=Z.hydrateRoot;const{Sider:ee}=d,te=[{key:"/dashboard",icon:a.jsx(p,{}),label:"Dashboard"},{key:"/studies",icon:a.jsx(_,{}),label:"Studies"},{key:"/patients",icon:a.jsx(m,{}),label:"Patients"},{key:"/sites",icon:a.jsx(g,{}),label:"Sites"},{key:"/alerts",icon:a.jsx(h,{}),label:"Alerts"},{key:"/agents",icon:a.jsx(f,{}),label:"AI Agents"},{key:"/conversational",icon:a.jsx(x,{}),label:"Chatbot"},{key:"/reports",icon:a.jsx(v,{}),label:"Reports"}];function ae({collapsed:e,onCollapse:t}){const s=F(),r=H();return a.jsxs(ee,{collapsible:!0,collapsed:e,onCollapse:t,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0},children:[a.jsxs("div",{style:{height:64,margin:16,display:"flex",alignItems:"center",justifyContent:e?"center":"flex-start"},children:[a.jsx(u,{style:{fontSize:24,color:"#fff"}}),!e&&a.jsx("span",{style:{color:"#fff",fontSize:16,fontWeight:"bold",marginLeft:12},children:"Clinical DM"})]}),a.jsx(y,{theme:"dark",mode:"inline",selectedKeys:[r.pathname],items:te,onClick:({key:e})=>s(e)})]})}const se=X()((e,t)=>({isConnected:!1,setConnected:t=>e({isConnected:t}),connectionState:"idle",setConnectionState:t=>e({connectionState:t}),backendReady:!1,setBackendReady:t=>e({backendReady:t}),connectionError:null,setConnectionError:t=>e({connectionError:t}),reconnectRequestId:0,requestReconnect:()=>e(e=>({reconnectRequestId:e.reconnectRequestId+1})),dashboardSummary:null,setDashboardSummary:t=>e({dashboardSummary:t}),recentUpdates:[],addUpdate:t=>e(e=>({recentUpdates:[t,...e.recentUpdates].slice(0,100)})),clearUpdates:()=>e({recentUpdates:[]}),activeAlerts:[],addAlert:t=>e(e=>({activeAlerts:[t,...e.activeAlerts],unreadNotifications:e.unreadNotifications+1})),updateAlert:(t,a)=>e(e=>({activeAlerts:e.activeAlerts.map(e=>e.alert_id===t?{...e,...a}:e)})),removeAlert:t=>e(e=>({activeAlerts:e.activeAlerts.filter(e=>e.alert_id!==t)})),setAlerts:t=>e({activeAlerts:t}),unreadNotifications:0,incrementNotifications:()=>e(e=>({unreadNotifications:e.unreadNotifications+1})),resetNotifications:()=>e({unreadNotifications:0}),selectedStudyId:null,setSelectedStudyId:t=>e({selectedStudyId:t}),selectedSiteId:null,setSelectedSiteId:t=>e({selectedSiteId:t}),dateRange:{start:null,end:null},setDateRange:t=>e({dateRange:t}),errors:[],addError:t=>e(e=>({errors:[t,...e.errors].slice(0,50)})),clearError:t=>e(e=>({errors:e.errors.filter((e,a)=>a!==t)})),clearAllErrors:()=>e({errors:[]}),loadingStates:{},setLoading:(t,a,s)=>e(e=>({loadingStates:{...e.loadingStates,[t]:{isLoading:a,operation:t,progress:s}}})),getLoading:e=>t().loadingStates[e],retryQueue:[],addToRetryQueue:(t,a,s=3)=>e(e=>({retryQueue:[...e.retryQueue,{id:t,operation:a,retries:0,maxRetries:s}]})),removeFromRetryQueue:t=>e(e=>({retryQueue:e.retryQueue.filter(e=>e.id!==t)})),processRetryQueue:()=>e(e=>{const a=[...e.retryQueue];return a.forEach(async(e,s)=>{if(e.retries<e.maxRetries)try{await e.operation(),a.splice(s,1)}catch(r){e.retries+=1,setTimeout(()=>{t().processRetryQueue()},1e3*Math.pow(2,e.retries))}else t().addError({message:`Operation ${e.id} failed after ${e.maxRetries} retries`,code:"MAX_RETRIES_EXCEEDED",timestamp:new Date,context:e.id}),a.splice(s,1)}),{retryQueue:a}})})),re=e=>{if(!e.response)return!0;const t=e.response.status;return t>=500||408===t||429===t};const ne="/api",ie=s.create({baseURL:ne,headers:{"Content-Type":"application/json"}});async function oe(e,t,a){const r=await async function(e,t={},a){const{maxRetries:r=3,baseDelay:n=1e3,maxDelay:i=1e4,retryCondition:o=re,onRetry:c}=t;let l;for(let u=0;u<=r;u++)try{null==a||a.onLoadingChange;const t=await s(e);return null==a||a.onLoadingChange,t}catch(d){if(l=d,u===r||!o(d))throw d;const e=Math.min(n*Math.pow(2,u),i),t=e+.1*Math.random()*e;c&&c(u+1,d),await new Promise(e=>setTimeout(e,t))}throw l}({...e,baseURL:ne},a);return r.data}const ce=async e=>{const{data:t}=await ie.get("/dashboard/initial-load",{params:{study_id:e}});return t},le={getAll:async()=>{const e=await oe({method:"GET",url:"/studies/"});return(Array.isArray(e)?e:[]).map(e=>({study_id:e.study_id,name:e.study_name||e.name||e.study_id,phase:e.phase||"Unknown",status:e.status||"unknown",therapeutic_area:e.therapeutic_area||"Unknown",total_patients:e.total_patients??0,total_sites:e.total_sites??0,clean_patients:e.clean_patients??0,dirty_patients:e.dirty_patients??0,dqi_score:e.dqi_score??e.overall_dqi??0,last_updated:e.last_updated||(new Date).toISOString()})).sort((e,t)=>{const a=Number.parseInt(e.study_id.replace(/\D/g,""),10),s=Number.parseInt(t.study_id.replace(/\D/g,""),10);return Number.isFinite(a)&&Number.isFinite(s)?a-s:e.study_id.localeCompare(t.study_id)})},getById:async e=>{var t,a;const s=await oe({method:"GET",url:`/studies/${e}`}),r=s.total_patients??s.current_enrollment??0,n=(null==(t=s.metrics)?void 0:t.cleanliness)??s.cleanliness??0,i=s.clean_patients??Math.round(r*n/100),o=s.dqi_score??s.overall_dqi??(null==(a=s.metrics)?void 0:a.dqi)??0;return{study_id:s.study_id,name:s.name||s.study_name||s.study_id,phase:s.phase||"Unknown",status:s.status||"active",therapeutic_area:s.therapeutic_area||"Unknown",total_patients:r,total_sites:s.total_sites||0,clean_patients:i,dirty_patients:s.dirty_patients??r-i,dqi_score:o,last_updated:s.last_updated||(new Date).toISOString()}},getMetrics:async e=>{const{data:t}=await ie.get(`/studies/${e}/metrics`);return t},getRegions:async e=>{const{data:t}=await ie.get(`/studies/${e}/regions`);return t},getTrends:async(e,t=30)=>{const{data:a}=await ie.get(`/studies/${e}/trends`,{params:{days:t}});return a},getRiskAssessment:async e=>{const{data:t}=await ie.get(`/studies/${e}/risk-assessment`);return t},getHeatmap:async(e,t="dqi")=>{const{data:a}=await ie.get(`/studies/${e}/heatmap`,{params:{metric:t}});return a},getSourceFiles:async e=>{const{data:t}=await ie.get(`/studies/${e}/source-files`);return t},getSites:async e=>{try{const{data:t}=await ie.get(`/studies/${e}/sites`);return(Array.isArray(t)?t:[]).map(e=>({site_id:e.site_id,name:e.name||e.site_name||e.site_id,country:e.country||"Unknown",region:e.region||"Unknown",status:e.status||"active",patient_count:e.patient_count||e.total_patients||0,dqi_score:e.dqi_score||e.overall_dqi||0,query_resolution_time:e.avg_query_resolution_days||0,last_updated:e.last_updated||(new Date).toISOString()}))}catch(t){return ue.getAll({study_id:e})}}},de={getAll:async e=>{const{data:t}=await ie.get("/patients/",{params:e});return(t.patients||t).map(e=>{var t,a,s,r;return{patient_id:e.patient_id,study_id:e.study_id,site_id:e.site_id,enrollment_date:e.enrollment_date||"",status:(null==(t=e.clean_status)?void 0:t.status)||"unknown",is_clean:(null==(a=e.clean_status)?void 0:a.is_clean)??!1,cleanliness_score:(null==(s=e.clean_status)?void 0:s.cleanliness_score)??0,visit_count:e.total_visits||e.completed_visits||0,query_count:(null==(r=e.clean_status)?void 0:r.open_queries)??0,last_updated:e.last_visit_date||""}})},getById:async e=>{const{data:t}=await ie.get(`/patients/${e}`);return t},getCleanStatus:async e=>{const{data:t}=await ie.get(`/patients/${e}/clean-status`);return{patient_id:e,is_clean:t.is_clean??!1,cleanliness_score:t.cleanliness_score??0,blocking_factors:(t.blocking_factors||[]).map(e=>"string"==typeof e?{factor_type:e,description:e,severity:"medium",domain:"general",resolution_action:"Review required"}:e),last_checked:t.last_calculated||(new Date).toISOString(),lock_readiness:t.is_clean?"Ready":"Not Ready"}},getDirtyPatients:async e=>{const{data:t}=await ie.get("/patients/dirty",{params:{study_id:e}});return(Array.isArray(t)?t:[]).map(e=>{var t,a,s;return{patient_id:e.patient_id,study_id:e.study_id,site_id:e.site_id,enrollment_date:e.enrollment_date||"",status:(null==(t=e.clean_status)?void 0:t.status)||"dirty",is_clean:!1,cleanliness_score:(null==(a=e.clean_status)?void 0:a.cleanliness_score)??0,visit_count:e.total_visits||0,query_count:(null==(s=e.clean_status)?void 0:s.open_queries)??0,last_updated:e.last_visit_date||""}})},getAtRiskPatients:async e=>{const{data:t}=await ie.get("/patients/at-risk",{params:{study_id:e}});return(Array.isArray(t)?t:[]).map(e=>{var t,a;return{patient_id:e.patient_id,study_id:e.study_id,site_id:e.site_id,enrollment_date:e.enrollment_date||"",status:"at-risk",is_clean:!1,cleanliness_score:(null==(t=e.clean_status)?void 0:t.cleanliness_score)??0,visit_count:e.total_visits||0,query_count:(null==(a=e.clean_status)?void 0:a.open_queries)??0,last_updated:e.last_visit_date||""}})},getStatusChanges:async(e=24)=>{const{data:t}=await ie.get("/patients/status-changes",{params:{hours:e}});return t},getBlockingFactors:async e=>{const{data:t}=await ie.get("/patients/blocking-factors",{params:{study_id:e}});return t},getLockReadiness:async e=>{const{data:t}=await ie.get("/patients/lock-readiness",{params:{study_id:e}});return t}},ue={getAll:async e=>{const{data:t}=await ie.get("/sites/",{params:e});return(Array.isArray(t)?t:[]).map(e=>({site_id:e.site_id,name:e.name||e.site_name||e.site_id,country:e.country||"Unknown",region:e.region||"Unknown",status:e.status||"active",patient_count:e.patient_count||e.total_patients||0,dqi_score:e.dqi_score||e.overall_dqi||0,query_resolution_time:e.avg_query_resolution_days||e.query_resolution_time||0,last_updated:e.last_updated||(new Date).toISOString()}))},getById:async e=>{const{data:t}=await ie.get(`/sites/${e}`);return{site_id:t.site_id,name:t.name||t.site_name||t.site_id,country:t.country||"Unknown",region:t.region||"Unknown",status:t.status||"active",patient_count:t.patient_count||t.total_patients||0,dqi_score:t.dqi_score||t.overall_dqi||0,query_resolution_time:t.avg_query_resolution_days||t.query_resolution_time||0,last_updated:t.last_updated||(new Date).toISOString()}},getPerformance:async e=>{const{data:t}=await ie.get(`/sites/${e}/performance`);return t},getHighRisk:async e=>{const{data:t}=await ie.get("/sites/high-risk",{params:{study_id:e}});return t},getSlowResolution:async(e,t=7)=>{const{data:a}=await ie.get("/sites/slow-resolution",{params:{study_id:e,threshold:t}});return a},getComparison:async e=>{const{data:t}=await ie.get("/sites/comparison",{params:{study_id:e}});return t},getCraActivity:async e=>{const{data:t}=await ie.get("/sites/cra-activity",{params:{study_id:e}});return t}},ye={getDashboardSummary:async e=>{try{const t=await ce(e);return{total_studies:t.summary.total_studies,total_patients:t.summary.total_patients,total_sites:t.summary.total_sites,clean_patients:t.summary.clean_patients,dirty_patients:t.summary.dirty_patients,overall_dqi:t.summary.overall_dqi,open_queries:t.summary.open_queries,pending_saes:t.summary.pending_saes,uncoded_terms:t.summary.uncoded_terms,_query_metrics:t.query_metrics,_cleanliness:t.cleanliness,_alerts:t.alerts,_response_time_ms:t._response_time_ms}}catch{const{data:t}=await ie.get("/dashboard/summary",{params:{study_id:e}});return t}},getKPITiles:async e=>{const{data:t}=await ie.get("/metrics/kpi-tiles",{params:{study_id:e}});return Array.isArray(t)?t:[]},getDQI:async(e,t,a)=>{const{data:s}=await ie.get("/metrics/dqi",{params:{study_id:e,site_id:t,days:a}});return{overall_dqi:s.overall_dqi??0,completeness:s.completeness??0,accuracy:s.accuracy??0,consistency:s.consistency??0,timeliness:s.timeliness??0,trend:s.trend??[],by_domain:{visits:s.completeness??0,queries:s.consistency??0,coding:s.accuracy??0,safety:s.conformity??s.timeliness??0,...s.by_domain??{}}}},getCleanliness:async(e,t,a)=>{const{data:s}=await ie.get("/metrics/cleanliness",{params:{study_id:e,site_id:t,days:a}}),r=s.clean_patients??s.clean_count??0,n=s.dirty_patients??s.dirty_count??0,i=s.pending_patients??s.at_risk_count??0;return{clean_count:r,dirty_count:n,at_risk_count:i,cleanliness_rate:r+n+i>0?s.overall_rate??s.cleanliness_rate??0:0,trend:s.trend??[],by_study:s.by_category??s.by_study??{}}},getQueries:async(e,t,a)=>{const{data:s}=await ie.get("/metrics/queries",{params:{study_id:e,site_id:t,days:a}});return{total_queries:s.total_queries??0,open_queries:s.open_queries??0,closed_queries:s.closed_queries??0,resolution_rate:s.resolution_rate??0,avg_resolution_time:s.avg_resolution_time_days??s.avg_resolution_time??0,aging_distribution:s.aging_distribution??{}}},getSAEs:async e=>{const{data:t}=await ie.get("/metrics/saes",{params:{study_id:e}});return{total_saes:t.total_saes??0,reconciled:t.reconciled??0,pending:t.pending??0,overdue:t.overdue??0,reconciliation_rate:t.reconciliation_rate??0,avg_reconciliation_days:t.avg_reconciliation_days??0,by_seriousness:t.by_seriousness??{}}},getCoding:async e=>{const{data:t}=await ie.get("/metrics/coding",{params:{study_id:e}});return{total_terms:t.total_terms??0,coded:t.coded??0,uncoded:t.uncoded??0,completion_rate:t.completion_rate??0,meddra_status:t.meddra_status??{},whodrug_status:t.whodrug_status??{},uncoded_breakdown:t.uncoded_breakdown??[]}},getVelocity:async(e,t=7,a)=>{const{data:s}=await ie.get("/metrics/velocity",{params:{study_id:e,site_id:a,days:t}}),r=s.trend||[],n=Array.isArray(r)&&r.length>0&&"object"==typeof r[0]?r:r.map((e,t)=>({date:new Date(Date.now()-864e5*(r.length-1-t)).toISOString().split("T")[0],queries:Math.round(e),resolutions:0}));return{queries_per_day:s.query_resolution_velocity??s.queries_per_day??0,resolutions_per_day:s.resolutions_per_day??0,data_entries_per_day:s.form_completion_velocity??s.data_entries_per_day??0,trend:n}},getHeatmap:async(e,t="dqi")=>{const{data:a}=await ie.get("/metrics/heatmap",{params:{study_id:e,metric:t}});return a},getAnomalies:async e=>{const{data:t}=await ie.get("/metrics/anomalies",{params:{study_id:e}});return t},getDQIBreakdown:async(e,t,a)=>{try{const s=await ye.getDQI(e,t,a);return{overall:s.overall_dqi||0,completeness:s.completeness||0,accuracy:s.accuracy||0,consistency:s.consistency||0,timeliness:s.timeliness||0,trend:s.trend||[]}}catch(s){throw s}}},pe={getAll:async e=>{const{data:t}=await ie.get("/alerts/",{params:e});return Array.isArray(t)?t:[]},getSummary:async()=>{const{data:e}=await ie.get("/alerts/summary");return e},getCritical:async()=>{const{data:e}=await ie.get("/alerts/critical");return e},getRecent:async(e=24)=>{const{data:t}=await ie.get("/alerts/recent",{params:{hours:e}});return t},acknowledge:async(e,t,a)=>{const{data:s}=await ie.post(`/alerts/${e}/acknowledge`,{acknowledged_by:t,note:a||""});return s},resolve:async(e,t,a,s)=>{const{data:r}=await ie.post(`/alerts/${e}/resolve`,{resolved_by:t,resolution_note:a||"",actions_taken:s||[]});return r},dismiss:async(e,t,a)=>{const{data:s}=await ie.post(`/alerts/${e}/dismiss`,null,{params:{dismissed_by:t,reason:a}});return s},getHistory:async(e=30,t)=>{const{data:a}=await ie.get("/alerts/history",{params:{days:e,category:t}});return a},getTrends:async(e=7)=>{const{data:t}=await ie.get("/alerts/trends",{params:{days:e}});return t}},_e={list:async()=>{const{data:e}=await ie.get("/reports/");return Array.isArray(e)?e:[]},getById:async e=>{const{data:t}=await ie.get(`/reports/${e}`);return t}},me={getStatus:async()=>{const{data:e}=await ie.get("/agents/status");if(Array.isArray(e)){const t={};return e.forEach(e=>{t[e.agent_type||e.name]=e}),t}return e||{}},getInsights:async e=>{const{data:t}=await ie.get("/agents/insights",{params:e});return Array.isArray(t)?t:[]},getRecommendations:async e=>{const{data:t}=await ie.get("/agents/recommendations",{params:e});return t},getExplainability:async e=>{const{data:t}=await ie.get(`/agents/explain/${e}`);return t},getReconciliationDiscrepancies:async(e,t)=>{const{data:a}=await ie.get("/agents/reconciliation/discrepancies",{params:{study_id:e,severity:t}});return a},getCodingIssues:async(e,t)=>{const{data:a}=await ie.get("/agents/coding/issues",{params:{study_id:e,status:t}});return a}},{Header:ge}=d;function he({connectionState:e,isConnected:t}){const s=t?"connected":e,r={connected:{color:"#52c41a",icon:a.jsx(T,{}),text:"Connected",tooltip:"Real-time connection active"},connecting:{color:"#1890ff",icon:a.jsx(D,{spin:!0}),text:"Connecting...",tooltip:"Establishing connection to server"},waiting_for_backend:{color:"#faad14",icon:a.jsx(q,{}),text:"Starting...",tooltip:"Waiting for backend services to initialize"},retrying:{color:"#faad14",icon:a.jsx(q,{}),text:"Retrying...",tooltip:"Retrying connection with backoff"},failed:{color:"#ff4d4f",icon:a.jsx(A,{}),text:"Failed",tooltip:"Connection failed. Please retry."},disconnected:{color:"#ff4d4f",icon:a.jsx(A,{}),text:"Disconnected",tooltip:"Connection lost. Reconnecting automatically..."},idle:{color:"#8c8c8c",icon:a.jsx(A,{}),text:"Idle",tooltip:"Connection idle"}}[s];return a.jsx(j,{title:r.tooltip,children:a.jsxs("div",{className:"realtime-indicator",style:{display:"flex",alignItems:"center",gap:6},children:["connected"===s&&a.jsx("div",{className:"realtime-dot"}),a.jsxs("span",{style:{color:r.color,display:"flex",alignItems:"center",gap:4},children:[r.icon," ",r.text]})]})})}function fe(){var e;const{isConnected:t,selectedStudyId:s,setSelectedStudyId:i,unreadNotifications:o,resetNotifications:c,connectionState:l,requestReconnect:d}=se(),{data:u=[]}=r({queryKey:["studies"],queryFn:le.getAll}),{data:y}=r({queryKey:["alertSummary"],queryFn:pe.getSummary,refetchInterval:3e4}),p=n.useMemo(()=>[{value:"",label:"All Studies"},...u.map(e=>({value:e.study_id,label:e.name||e.study_id}))],[u]),_=n.useMemo(()=>[{key:"profile",label:"Profile"},{key:"settings",label:"Settings"},{type:"divider"},{key:"logout",label:"Logout"}],[]);return a.jsxs(ge,{style:{padding:"0 24px",background:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)"},children:[a.jsxs(w,{size:"large",children:[a.jsx(b,{style:{width:200},placeholder:"Select Study",value:s||"",onChange:e=>i(e||null),options:p}),a.jsx(he,{connectionState:l,isConnected:t})]}),a.jsxs(w,{size:"middle",children:[a.jsx(j,{title:"Force reconnect to server",children:a.jsx(S,{type:"text",icon:a.jsx(k,{}),onClick:d,"aria-label":"Reconnect real-time data",children:"Reconnect"})}),a.jsx(R,{count:(null==(e=null==y?void 0:y.by_severity)?void 0:e.critical)||0,style:{backgroundColor:"#ff4d4f"},children:a.jsx(R,{count:o,offset:[0,0],children:a.jsx(S,{type:"text",icon:a.jsx(C,{style:{fontSize:20}}),onClick:c,"aria-label":"Open notifications"})})}),a.jsx(E,{menu:{items:_},children:a.jsx(I,{icon:a.jsx(m,{}),style:{cursor:"pointer"}})})]})]})}const{Title:xe,Text:ve,Paragraph:we}=O;class be extends n.Component{constructor(e){super(e),t(this,"reportError",async(e,t)=>{try{const a=localStorage.getItem("auth_token"),s={"Content-Type":"application/json"};a&&(s.Authorization=`Bearer ${a}`),await fetch("/api/errors/report",{method:"POST",headers:s,body:JSON.stringify({message:e.message,stack:e.stack,component_stack:t.componentStack,timestamp:(new Date).toISOString(),user_agent:navigator.userAgent,url:window.location.href})})}catch(a){}}),t(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})}),t(this,"handleGoHome",()=>{window.location.href="/"}),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t),this.reportError(e,t)}render(){var e;return this.state.hasError?this.props.fallback?this.props.fallback:a.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:a.jsx(L,{status:"error",icon:a.jsx($,{style:{color:"#ff4d4f"}}),title:a.jsx(xe,{level:3,style:{color:"#ff4d4f",marginBottom:8},children:"Something went wrong"}),subTitle:a.jsxs(w,{direction:"vertical",size:"small",children:[a.jsx(ve,{type:"secondary",children:"An unexpected error occurred while loading this page."}),a.jsxs(ve,{type:"secondary",style:{fontSize:"12px"},children:["Error: ",(null==(e=this.state.error)?void 0:e.message)||"Unknown error"]})]}),extra:a.jsxs(w,{children:[a.jsx(S,{type:"primary",icon:a.jsx(N,{}),onClick:this.handleRetry,children:"Try Again"}),a.jsx(S,{icon:a.jsx(P,{}),onClick:this.handleGoHome,children:"Go Home"})]}),children:!1})}):this.props.children}}const je=`${"https:"===window.location.protocol?"wss":"ws"}://${window.location.host}`,Se=1e3;function ke(){const e=n.useRef(null),t=n.useRef(null),a=n.useRef(null),s=n.useRef(null),r=n.useRef(null),i=n.useRef(Se),o=n.useRef(null),c=n.useRef(!1),l=n.useRef(0),d=n.useRef(!1),u=n.useRef(!1),{setConnected:y,addUpdate:p,addAlert:_,addError:m,setConnectionState:g,setBackendReady:h,setConnectionError:f,backendReady:x,reconnectRequestId:v}=se();n.useEffect(()=>{u.current=x},[x]);const w=n.useCallback(async()=>{try{const e=await fetch("/api/ready");if(e.ok){return(await e.json()).is_ready}return e.status,!1}catch{return!1}},[]),b=n.useCallback(async()=>(null===o.current&&(o.current=Date.now()),g("waiting_for_backend"),new Promise(e=>{const t=async()=>{if(Date.now()-(o.current||Date.now())>6e4)return o.current=null,r.current&&(clearInterval(r.current),r.current=null),void e(!1);await w()&&(h(!0),o.current=null,r.current&&(clearInterval(r.current),r.current=null),e(!0))};t(),r.current||(r.current=setInterval(t,2e3))})),[w]),j=n.useCallback(()=>{t.current&&(clearTimeout(t.current),t.current=null),a.current&&(clearInterval(a.current),a.current=null),s.current&&(clearTimeout(s.current),s.current=null),r.current&&(clearInterval(r.current),r.current=null)},[]),S=n.useCallback(()=>{a.current&&clearInterval(a.current),a.current=setInterval(()=>{var t;if((null==(t=e.current)?void 0:t.readyState)===WebSocket.OPEN)try{e.current.send(JSON.stringify({type:"ping"})),s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{var t;null==(t=e.current)||t.close()},1e4)}catch(a){}},25e3)},[]),k=n.useCallback(e=>{if(t.current&&clearTimeout(t.current),d.current)return;if(l.current>=8)return g("failed"),f("Connection failed after multiple attempts. Please retry."),void m({message:"Real-time connection failed after multiple attempts. Use Reconnect to try again.",code:"WS_RECONNECT_FAILED",timestamp:new Date,context:"WebSocket"});const a=e??Math.min(i.current,3e4);g("retrying"),t.current=setTimeout(()=>{l.current+=1,i.current=Math.min(1.5*i.current,3e4),R()},a)},[g,f,m]),R=n.useCallback(async()=>{var t,a;if(!c.current&&(null==(t=e.current)?void 0:t.readyState)!==WebSocket.OPEN&&(null==(a=e.current)?void 0:a.readyState)!==WebSocket.CONNECTING){c.current=!0,d.current=!1;try{if(!u.current){if(!(await b()))return c.current=!1,void k(2e3)}g("connecting"),f(null);const t=(()=>{const e=je.replace(/\/$/,""),t=localStorage.getItem("auth_token");if(t)return`${e}/ws/dashboard?token=${encodeURIComponent(t)}`;return`${e}/ws/dashboard`})();e.current=new WebSocket(t),e.current.onopen=()=>{g("connected"),y(!0),c.current=!1,l.current=0,i.current=Se,S()},e.current.onmessage=e=>{try{const t=JSON.parse(e.data);if("pong"===t.type||"heartbeat"===t.type)return void(s.current&&(clearTimeout(s.current),s.current=null));const a=t;p(a),"new_alert"===a.type&&a.data&&_(a.data)}catch(t){}},e.current.onclose=e=>{g("disconnected"),y(!1),c.current=!1,j(),d.current||1e3===e.code||(f(e.reason||"WebSocket connection closed"),k())},e.current.onerror=()=>{f("WebSocket error occurred"),c.current=!1}}catch(r){g("disconnected"),y(!1),f("Failed to establish WebSocket connection"),c.current=!1,k()}}},[y,p,_,b,S,k,j,g,f]),C=n.useCallback(()=>{R()},[R]),E=n.useCallback(()=>{j(),c.current=!1,d.current=!0,e.current&&(e.current.close(1e3,"User disconnect"),e.current=null),g("disconnected"),y(!1),h(!1),f(null),o.current=null,i.current=Se,l.current=0},[y,j,h,g,f]),I=n.useCallback(t=>{var a;(null==(a=e.current)?void 0:a.readyState)===WebSocket.OPEN&&e.current.send(JSON.stringify(t))},[]),A=n.useCallback(()=>{E(),h(!1),setTimeout(()=>C(),100)},[E,C]);return n.useEffect(()=>{C();const t=()=>{var t;"visible"===document.visibilityState&&((null==(t=e.current)?void 0:t.readyState)===WebSocket.OPEN||d.current||C())};document.addEventListener("visibilitychange",t);const a=()=>{h(!1),C()};return window.addEventListener("online",a),()=>{E(),document.removeEventListener("visibilitychange",t),window.removeEventListener("online",a)}},[C,E]),n.useEffect(()=>{v>0&&A()},[v,A]),{connect:C,disconnect:E,send:I,forceReconnect:A}}const Re=()=>{const{errors:e,clearError:t,clearAllErrors:s}=se();return n.useEffect(()=>{e.forEach((e,s)=>{z.error({message:"Error Occurred",description:e.message,duration:5e3,key:`error-${s}-${e.timestamp.getTime()}`,icon:a.jsx($,{style:{color:"#ff4d4f"}}),onClose:()=>t(s)})})},[e,t]),0===e.length?null:a.jsx("div",{style:{position:"fixed",top:"70px",right:"20px",zIndex:1e3,maxWidth:"400px"},children:a.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[e.slice(0,3).map((e,s)=>a.jsx(U,{message:"Error",description:a.jsxs("div",{children:[a.jsx("div",{style:{marginBottom:"8px"},children:e.message}),e.code&&a.jsxs("div",{style:{fontSize:"12px",color:"#8c8c8c"},children:["Code: ",e.code]}),a.jsx("div",{style:{fontSize:"12px",color:"#8c8c8c"},children:e.timestamp.toLocaleTimeString()})]}),type:"error",closable:!0,onClose:()=>t(s),action:a.jsx(S,{size:"small",type:"text",icon:a.jsx(B,{}),onClick:()=>t(s)}),style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",borderRadius:"6px"}},s)),e.length>3&&a.jsxs(S,{size:"small",type:"link",onClick:s,style:{padding:0},children:["Clear all ",e.length," errors"]})]})})},Ce=n.lazy(()=>M(()=>import("./Dashboard-CiOe9L3-.js"),__vite__mapDeps([0,1,2,3,4,5]))),Ee=n.lazy(()=>M(()=>import("./Studies-CKMbmS3U.js"),__vite__mapDeps([6,1,4,2,5]))),Ie=n.lazy(()=>M(()=>import("./Patients-Cn2mWvge.js"),__vite__mapDeps([7,1,4,2,5]))),Ae=n.lazy(()=>M(()=>import("./Sites-CzSm8W8P.js"),__vite__mapDeps([8,1,4,2,5]))),qe=n.lazy(()=>M(()=>import("./Alerts-Cc1w_COO.js"),__vite__mapDeps([9,1,2,3,4,5]))),De=n.lazy(()=>M(()=>import("./Agents-BPZDgtwD.js"),__vite__mapDeps([10,1,2,4,5]))),Te=n.lazy(()=>M(()=>import("./Conversational-CGfQKJBi.js"),__vite__mapDeps([11,1,2,4,5]))),Oe=n.lazy(()=>M(()=>import("./Reports-CFW_azQv.js"),__vite__mapDeps([12,1,2,4,5]))),{Content:Le}=d;function Ne(){return a.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400,padding:48},children:a.jsx(Q,{size:"large",tip:"Loading page..."})})}function Pe(){ke();const[e,t]=n.useState(!1),s=e?80:200,r=se(e=>e.addError),i=(e,t)=>{r({message:e.message,code:"UI_ERROR",timestamp:new Date,context:"App Component"})};return a.jsx(be,{onError:i,children:a.jsxs(V,{children:[a.jsxs(d,{style:{minHeight:"100vh"},children:[a.jsx(ae,{collapsed:e,onCollapse:t}),a.jsxs(d,{style:{marginLeft:s},children:[a.jsx(fe,{}),a.jsx(Le,{style:{margin:"24px 16px",padding:24,minHeight:280,background:"#f0f2f5",overflow:"auto"},children:a.jsx(be,{onError:i,children:a.jsx(n.Suspense,{fallback:a.jsx(Ne,{}),children:a.jsxs(G,{children:[a.jsx(K,{path:"/",element:a.jsx(J,{to:"/dashboard",replace:!0})}),a.jsx(K,{path:"/dashboard",element:a.jsx(Ce,{})}),a.jsx(K,{path:"/studies",element:a.jsx(Ee,{})}),a.jsx(K,{path:"/studies/:studyId",element:a.jsx(Ee,{})}),a.jsx(K,{path:"/patients",element:a.jsx(Ie,{})}),a.jsx(K,{path:"/patients/:patientId",element:a.jsx(Ie,{})}),a.jsx(K,{path:"/sites",element:a.jsx(Ae,{})}),a.jsx(K,{path:"/sites/:siteId",element:a.jsx(Ae,{})}),a.jsx(K,{path:"/alerts",element:a.jsx(qe,{})}),a.jsx(K,{path:"/agents",element:a.jsx(De,{})}),a.jsx(K,{path:"/conversational",element:a.jsx(Te,{})}),a.jsx(K,{path:"/reports",element:a.jsx(Oe,{})})]})})})})]})]}),a.jsx(Re,{})]})})}const $e=new i({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1,staleTime:3e4}}});Y.createRoot(document.getElementById("root")).render(a.jsx(o.StrictMode,{children:a.jsx(c,{client:$e,children:a.jsx(W,{theme:{token:{colorPrimary:"#1a365d",colorLink:"#2b6cb0",borderRadius:8,borderRadiusLG:12,borderRadiusSM:4,fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",fontSize:14,colorSuccess:"#2f855a",colorWarning:"#c05621",colorError:"#c53030",colorInfo:"#2b6cb0",colorBgContainer:"#ffffff",colorBgLayout:"#f7fafc"},components:{Card:{borderRadiusLG:12,boxShadowTertiary:"0 1px 3px 0 rgba(0, 0, 0, 0.08), 0 1px 2px 0 rgba(0, 0, 0, 0.04)"},Button:{borderRadius:6},Select:{borderRadius:6},Input:{borderRadius:6}}},children:a.jsx(be,{children:a.jsx(Pe,{})})})})}));export{pe as a,me as b,ue as c,ye as m,de as p,_e as r,le as s,se as u};
